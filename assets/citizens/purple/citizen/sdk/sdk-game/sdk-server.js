var c=(e,t)=>()=>(e&&(t=e(e=0)),t),b=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var p=c(()=>{});function S(){return GetConvarInt("sdk_worldEditorMode",0)===1?1:0}function R(){return GetConvarInt("sv_fxdkServerMode",0)===1?0:1}function G(e){e=e.toLowerCase();let t=new Uint32Array(1);for(let r in e)t[0]+=e.charCodeAt(r),t[0]+=t[0]<<10,t[0]^=t[0]>>>6;return t[0]+=t[0]<<3,t[0]^=t[0]>>>11,t[0]+=t[0]<<15,t[0]}function m(e){return"0x"+G(e).toString(16).toUpperCase()}var f,s,_=c(()=>{(function(e){e[e.NORMAL=0]="NORMAL",e[e.WORLD_EDITOR=1]="WORLD_EDITOR"})(f||(f={}));(function(e){e[e.NORMAL=0]="NORMAL",e[e.LEGACY=1]="LEGACY"})(s||(s={}))});function l(e,t){emitNet("sessionHostResult",e,t)}function C(){for(let e of g)l(e,"free")}var o,g,v=c(()=>{p();g=[];onNet("hostingSession",()=>{if(o)return l(source,"wait"),g.push(source);if(GetHostId()&&GetPlayerLastMsg(GetHostId())<1e3)return l(source,"conflict");g=[],o=source,l(source,"go"),setTimeout(()=>{o!==void 0&&(o=void 0,C())},5e3)});onNet("hostedSession",()=>{if(o!==source){console.log(`${o} ~= ${source}`);return}C(),o=void 0});EnableEnhancedHostSupport(!0)});var I={};var L=c(()=>{v()});var O=b((j,u)=>{var E=require("stream"),A=require("util"),T=require("timers");u.exports=function(e,t){return u.exports.createStream(e,t)};u.exports.createStream=function(e,t){return e?x(e,t):new n(t)};u.exports.createLineStream=function(e){return console.log("WARNING: byline#createLineStream is deprecated and will be removed soon"),x(e)};function x(e,t){if(!e)throw new Error("expected readStream");if(!e.readable)throw new Error("readStream must be readable");var r=new n(t);return e.pipe(r),r}u.exports.LineStream=n;function n(e){E.Transform.call(this,e),e=e||{},this._readableState.objectMode=!0,this._lineBuffer=[],this._keepEmptyLines=e.keepEmptyLines||!1,this._lastChunkEndedWithCR=!1;var t=this;this.on("pipe",function(r){t.encoding||r instanceof E.Readable&&(t.encoding=r._readableState.encoding)})}A.inherits(n,E.Transform);n.prototype._transform=function(e,t,r){t=t||"utf8",Buffer.isBuffer(e)&&(t=="buffer"?(e=e.toString(),t="utf8"):e=e.toString(t)),this._chunkEncoding=t;var i=e.split(/\r\n|[\n\v\f\r\x85\u2028\u2029]/g);this._lastChunkEndedWithCR&&e[0]==`
`&&i.shift(),this._lineBuffer.length>0&&(this._lineBuffer[this._lineBuffer.length-1]+=i[0],i.shift()),this._lastChunkEndedWithCR=e[e.length-1]=="\r",this._lineBuffer=this._lineBuffer.concat(i),this._pushBuffer(t,1,r)};n.prototype._pushBuffer=function(e,t,r){for(;this._lineBuffer.length>t;){var i=this._lineBuffer.shift();if((this._keepEmptyLines||i.length>0)&&!this.push(this._reencode(i,e))){var y=this;T.setImmediate(function(){y._pushBuffer(e,t,r)});return}}r()};n.prototype._flush=function(e){this._pushBuffer(this._chunkEncoding,0,e)};n.prototype._reencode=function(e,t){return this.encoding&&this.encoding!=t?new Buffer(e,t).toString(this.encoding):this.encoding?e:new Buffer(e,t)}});var z={};var q,D,H,M,W,w,d,h,a,B,N=c(()=>{_();q=require("net"),D=O(),H=m("REGISTER_CONSOLE_LISTENER"),M=m("GET_CONSOLE_BUFFER"),W="\\\\.\\pipe\\fxdk_fxserver_sdk_game_"+GetConvar("sv_fxdkPipeAppendix",""),w=q.createConnection(W),d=(e,t)=>{w.write(JSON.stringify([e,t])+`
`)},h=()=>{d("state",a)},a={};on("onResourceStart",e=>{a[e]=!0,h()});on("onResourceStop",e=>{a[e]=!1,h()});B=D.createStream();B.on("data",e=>{try{let[t,r]=JSON.parse(e.toString());switch(t){case"state":return h();case"restart":{a[r]&&ExecuteCommand(`restart ${r}`);return}case"stop":{a[r]&&ExecuteCommand(`stop ${r}`);return}case"start":{a[r]||ExecuteCommand(`start ${r}`);return}case"refresh":return ExecuteCommand("refresh")}}catch(t){console.log("Invalid data received",e.toString(),t)}});w.pipe(B);setTimeout(()=>{d("ready"),d("consoleBuffer",Citizen.invokeNative(M,Citizen.resultAsString())),Citizen.invokeNative(H,Citizen.makeRefFunction((e,t)=>d("console",{channel:e,message:t}))),["sessionmanager","sessionmanager-rdr3"].map(e=>{let t=GetResourceState(e);(t==="starting"||t==="started")&&(a[e]=!0,h())})},0)});p();_();switch(R()){case s.NORMAL:{console.log("^3Hooray, FxDK server mode!"),S()===f.WORLD_EDITOR&&(L(),I);break}case s.LEGACY:{N();break}}
