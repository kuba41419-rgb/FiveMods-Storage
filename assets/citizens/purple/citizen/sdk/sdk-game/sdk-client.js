var u=(t,e)=>()=>(t&&(e=t(t=0)),e);function Re(){return GetConvarInt("sdk_worldEditorMode",0)===1?1:0}function V(t){t=t.toLowerCase();let e=new Uint32Array(1);for(let i in t)e[0]+=t.charCodeAt(i),e[0]+=e[0]<<10,e[0]^=e[0]>>>6;return e[0]+=e[0]<<3,e[0]^=e[0]>>>11,e[0]+=e[0]<<15,e[0]}function ue(t){return"0x"+V(t).toString(16).toUpperCase()}var j,we,B=u(()=>{(function(t){t[t.NORMAL=0]="NORMAL",t[t.WORLD_EDITOR=1]="WORLD_EDITOR"})(j||(j={}));(function(t){t[t.NORMAL=0]="NORMAL",t[t.LEGACY=1]="LEGACY"})(we||(we={}))});function C(t,e){Citizen.invokeNative(xe,JSON.stringify({type:t,data:e}))}function ie(t,e){Citizen.invokeNative(ke,JSON.stringify({type:t,data:e}))}function Pe(t,e){let i=JSON.stringify({type:t,data:e});Citizen.invokeNative(xe,i),Citizen.invokeNative(ke,i)}var xe,ke,U=u(()=>{B();xe=ue("SEND_SDK_MESSAGE"),ke=ue("SEND_SDK_MESSAGE_TO_BACKEND")});var Oe=u(()=>{U();setTick(()=>{let t=PlayerPedId();C("fxdk:data",[{key:"player_ped_pos",value:GetEntityCoords(t,!0)},{key:"player_ped_rot",value:GetEntityRotation(t,2)},{key:"player_ped_heading",value:GetEntityHeading(t)}])})});var re,ne,lt,Te=u(()=>{U();re=!1,ne=!1,lt=setTick(()=>{!ne&&IsScreenFadedOut()&&(ne=!0),!re&&!GetIsLoadingScreenActive()&&(re=!0),ne&&re&&clearTick(lt)});setTimeout(()=>{(!re||!ne)&&C("fxdk:loadingScreenWarning")},1e4)});var pt={};var We=u(()=>{Oe();Te()});function S(t){return t}var De=u(()=>{});var jt,Nt,Lt,It,Ft,Gt,zt,_t,Vt,Bt,Ut,M,He=u(()=>{De();jt=S({checkCreateRequest:"project:checkCreateRequest",checkCreateResult:"project:checkCreateResult",checkOpenRequest:"project:checkOpenRequest",create:"project:create",open:"project:open",close:"project:close",update:"project:update",build:"project:build",buildError:"project:buildError",setServerUpdateChannel:"project:setServerUpdateChannel",setSystemResources:"project:setSystemResources",setVariable:"project:setVariable",getRecents:"project:getRecents",recents:"project:recents",removeRecent:"project:removeRecent",pathsStateUpdate:"project:pathsStateUpdate",setPathsStatePatch:"project:setPathsStatePatch",setAssetConfig:"project:setResourceConfig",fsUpdate:"project:fsUpdate",createFile:"project:createFile",createDirectory:"project:createDirectory",renameEntry:"project.renameEntry",entryRenamed:"project.entryRenamed",moveEntry:"project:moveEntry",entryMoved:"porject.entryMoved",deleteEntry:"project:deleteEntry",entryDeleted:"project.entryDeleted",copyEntry:"project:copyEntry",copyEntries:"project:copyEntries",freePendingFolderDeletion:"project:freePendingFolderDeletion",startServer:"project:startServer",stopServer:"project:stopServer"}),Nt=S({create:"asset:create",import:"asset:import",setConfig:"asset:setConfig",updates:"asset:updates"}),Lt=S({fetchReleases:"github:fetchReleases"}),It=S({ackState:"ackState",state:"state",serverDataState:"serverDataState",gameLaunched:"state:gameLaunched",setUserId:"state:setUserId"}),Ft=S({readDirRecursive:"explorer:readDirRecursive",readDir:"explorer:readDir",dir:"explorer:dir",dirRecursive:"explorer:dirRecursive"}),Gt=S({ackState:"server:ackState",state:"server:state",resourceDatas:"server:resourceDatas",bufferedOutput:"server:output",structuredOutputMessage:"server:outputStructured",clearOutput:"server:clearOutput",sendCommand:"server:sendCommand",ackResourcesState:"server:ackResourcesState",resourcesState:"server:resourcesState",restartResource:"server:restartResource",stopResource:"server:stopResource",startResource:"server:startResource",updateChannelsState:"server:updateChannelsState",ackUpdateChannelsState:"server:ackUpdateChannelsState",checkForUpdates:"server:checkForUpdates",installUpdate:"server:installUpdate"}),zt=S({ack:"statuses:ack",update:"statuses:update",statuses:"statuses:statuses"}),_t=S({ack:"notifications:ack",create:"notifications:create",delete:"notifications:delete"}),Vt=S({ackTasks:"taskReporter:ackTasks",tasks:"taskReporter:tasks",taskAdded:"taskReporter:taskAdded",taskChanged:"taskReporter:taskChanged",taskDeleted:"taskReporter:taskDeleted"}),Bt=S({output:"output:output",outputLabel:"output:outputLabel",flush:"output:flush"}),Ut=S({ack:"game:ack",gameState:"game:gameState",gameLaunched:"game:gameLaunched",gameProcessStateChanged:"game:gameStateChanged",connectionStateChanged:"game:connectionStateChanged",start:"game:start",stop:"game:stop",restart:"game:restart",refreshArchetypesCollection:"game:refreshArchetypesCollection"}),M=S({start:"we:start",stop:"we:stop",stopped:"we:stopped",mapLoaded:"we:mapLoaded",setCam:"we:setCam",createPatch:"we:createPatch",applyPatchChange:"we:applyPatchChange",deletePatch:"we:deletePatch",createAddition:"we:createAddition",additionPlaced:"we:additionPlaced",deleteAddition:"we:deleteAddition",setAddition:"we:setAddition",applyAdditionChange:"we:applyAdditionChange",setAdditionGroup:"we:setAdditionGroup",createAdditionGroup:"we:createAdditionGroup",deleteAdditionGroup:"we:deleteAdditionGroup",setAdditionGroupLabel:"we:setAdditionGroupName"})});function h(t){return t}var c,P=u(()=>{He();c=Object.freeze({Ready:h("we:ready"),Map:h("we:map"),Accept:h("we:accept"),SetCam:h(M.setCam),SetCamBaseMultiplier:h("we:setCamBaseMultiplier"),FocusInView:h("we:focusInView"),ObjectPreview:h("we:objectPreview"),SelectAtCursor:h("we:selectAtCursor"),Selection:h("we:selection"),EnterPlaytestMode:h("we:enterPlaytestMode"),ExitPlaytestMode:h("we:exitPlaytestMode"),EnvironmentSet:h("we:setEnvironment"),EnvironmentAck:h("we:ackEnvironment"),EnvironmentRequest:h("we:reqeustEnvironment"),SettingsSet:h("we:settings"),AdditionCreate:h(M.createAddition),AdditionPlaced:h(M.additionPlaced),AdditionSet:h(M.setAddition),AdditionApplyChange:h(M.applyAdditionChange),AdditionSetOnGround:h("we:setAdditionOnGround"),AdditionDelete:h(M.deleteAddition),AdditionDeleteBatch:h("we:deleteAdditions"),PatchCreate:h(M.createPatch),PatchApplyChange:h(M.applyPatchChange),PatchDelete:h(M.deletePatch)})});var q,se,je=u(()=>{q={LOOK_X:1,LOOK_Y:2,MOVE_X:30,MOVE_Y:31,MOVE_Z:[152,153],MOVE_FAST:21,MOVE_SLOW:19},se={LOOK_SENSETIVITY:[15,15],BASE_MOVE_MULTIPLIER:1,FAST_MOVE_MULTIPLIER:10,SLOW_MOVE_MULTIPLIER:10,CAMERA_FOV:45}});var Ne,m,N,E,Y=u(()=>{(function(t){t[t.V1=1]="V1",t[t.V2=2]="V2",t[t.V3=3]="V3"})(Ne||(Ne={}));(function(t){t[t.RX=0]="RX",t[t.RY=1]="RY",t[t.RZ=2]="RZ",t[t.RW=3]="RW",t[t.FX=4]="FX",t[t.FY=5]="FY",t[t.FZ=6]="FZ",t[t.FW=7]="FW",t[t.UX=8]="UX",t[t.UY=9]="UY",t[t.UZ=10]="UZ",t[t.UW=11]="UW",t[t.AX=12]="AX",t[t.AY=13]="AY",t[t.AZ=14]="AZ",t[t.AW=15]="AW"})(m||(m={}));(function(t){t[t.TIME=0]="TIME",t[t.FREEZE_TIME=1]="FREEZE_TIME",t[t.PERSISTENT_WEATHER=2]="PERSISTENT_WEATHER",t[t.RANDOM_WEATHER=3]="RANDOM_WEATHER"})(N||(N={}));(function(t){t[t.NONE=0]="NONE",t[t.PATCH=1]="PATCH",t[t.ADDITION=2]="ADDITION"})(E||(E={}))});function ut(t,e,i){return Math.min(i,Math.max(e,t))}function me(t){return t*ht}function ze(t){let e,i,r=t*.5;return i=t,Ie[0]=t,e=Fe[0],e=1597463007-(e>>1),Fe[0]=e,i=Ie[0],i=i*(Ge-r*i*i),i=i*(Ge-r*i*i),i}function ft(t){return[G([t[0],t[1],t[2],t[3]]),G([t[4],t[5],t[6],t[7]]),G([t[8],t[9],t[10],t[11]])]}function _e(t,e){let i=ft(t),[r,n,s]=[e[0]/i[0],e[1]/i[1],e[2]/i[2]];t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t[4]*=n,t[5]*=n,t[6]*=n,t[7]*=n,t[8]*=s,t[9]*=s,t[10]*=s,t[11]*=s}function G([t,e,i=0,r=0]){return 1/ze(t**2+e**2+i**2+r**2)}function z(t){let[e,i,r,n]=GetEntityMatrix(t);return new Float32Array([i[0],i[1],i[2],0,e[0],e[1],e[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],1])}function oe(t,e){SetEntityMatrix(t,e[4],e[5],e[6],e[0],e[1],e[2],e[8],e[9],e[10],e[12],e[13],e[14])}function ae(t,e){SetEntityCoords(t,e[m.AX],e[m.AY],e[m.AZ],!1,!1,!1,!1);let i=bt(e);SetEntityRotation(t,i[0],i[1],i[2],2,!1),SetEntityMatrix(t,e[4],e[5],e[6],e[0],e[1],e[2],e[8],e[9],e[10],e[12],e[13],e[14])}function yt(t,e){return(t*e|0)/e}function Ve(t,e){return t.map(i=>yt(i,e))}function bt(t){let e=0,i=0,r=0,n=t[m.RX],s=t[m.FX],o=t[m.UX],a=t[m.RY],l=t[m.FY],f=t[m.UY],_=t[m.RZ],F=t[m.FZ],b=t[m.UZ];return e=Math.asin(Math.max(-1,Math.min(1,F))),Math.abs(F)<.99999?(i=Math.atan2(-_,b),r=Math.atan2(-s,l)):(i=0,r=Math.atan2(a,n)),[e*fe,i*fe,r*fe]}function gt([t,e],[i,r]){let n=Math.atan2(e,t)-Math.atan2(r,i);return n<0&&(n+=2*Math.PI),me(n)}function Be([t,e],[i,r]){return-gt([0,1],[i-t,r-e])}function mt(t,e){return new y(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}var R,ht,Le,Ie,Fe,Ge,y,X,fe,$t,Z=u(()=>{Y();R=Math.PI/180,ht=180/Math.PI;Le=new ArrayBuffer(4),Ie=new Float32Array(Le),Fe=new Uint32Array(Le),Ge=1.5;y=class{constructor(e,i,r){this.x=e;this.y=i;this.z=r}static zero(){return new y(0,0,0)}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}mult(e){return typeof e=="number"?(this.x*=e,this.y*=e,this.z*=e,this):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}normal(){let e=ze(this.x*this.x+this.y*this.y+this.z*this.z);return new y(this.x*e,this.y*e,this.z*e)}length(){return G([this.x,this.y,this.z])}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}copy(){return new y(this.x,this.y,this.z)}cross(e){return mt(this,e)}toArray(){return[this.x,this.y,this.z]}},X=class{constructor(e,i,r){this.x=e;this.y=i;this.z=r}static zero(){return new X(0,0,0)}forward(){let e=this.x*R,i=this.y*R,r=this.z*R,n=Math.sin(e),s=Math.sin(i),o=Math.sin(r),a=Math.cos(e),l=Math.cos(i),f=Math.cos(r);return new y(f*n*s-a*o,a*f-n*s*o,l*n).normal()}left(){let e=this.x*R,i=this.y*R,r=this.z*R,n=Math.sin(e),s=Math.sin(i),o=Math.sin(r),a=Math.cos(e),l=Math.cos(i),f=Math.cos(r);return new y(l*f,l*o,-s).normal()}directions(){let e=this.x*R,i=this.y*R,r=this.z*R,n=Math.sin(e),s=Math.sin(i),o=Math.sin(r),a=Math.cos(e),l=Math.cos(i),f=Math.cos(r);return[new y(f*n*s-a*o,a*f-n*s*o,l*n).normal(),new y(l*f,l*o,-s).normal()]}clamp(){return this.x=ut(this.x,-90,90),this.y=this.y%360,this.z=this.z%360,this}};fe=180/Math.PI,$t=Math.PI/180});function K(t){return Array.isArray(t)?GetDisabledControlNormal(0,t[0])-GetDisabledControlNormal(0,t[1]):GetDisabledControlNormal(0,t)}function J(t,e,i,r){let n=new Set,s=new Set,o={isActive:!1,on:a=>(n.add(a),()=>n.delete(a)),off:a=>(s.add(a),()=>s.delete(a))};return RegisterCommand("+"+t,()=>{o.isActive=!0,new Set(n).forEach(l=>l())},!1),RegisterCommand("-"+t,()=>{o.isActive=!1,new Set(s).forEach(l=>l())},!1),RegisterKeyMapping("+"+t,e,i,r),o}function p(t,e){on(t,i=>{e(i?JSON.parse(i):void 0)})}function O(t,e){C(t,e)}function ye(t,e){ie(t,e)}function Q(t,e){Pe(t,e)}var be,w=u(()=>{U();be=class{constructor(e,i=r=>JSON.stringify(r)){this.serializer=i;this.s=i(e)}compareAndStore(e){let i=this.serializer(e),r=!0;return this.s!==i&&(r=!1),this.s=i,r}}});var A,$=u(()=>{P();w();A=new class{constructor(){this.settings={mouseSensetivity:15,cameraAboveTheGround:!0,showSelectionBoundingBox:!0,playtestSpawnInVehicle:!1,playtestVehicleName:""}}preinit(){p(c.SettingsSet,e=>{this.settings={...this.settings,...e}})}}});var d,Ue,qe,Ye,Xe,L=u(()=>{P();je();Z();$();w();d=new class{constructor(){this.destroyed=!1;this.pos=new y(0,0,100);this.rot=X.zero();this.forwardVector=y.zero();this.move={x:0,y:0};this.baseMoveMultiplier=se.BASE_MOVE_MULTIPLIER;this.fov=45;this.acceleration=0;this.speedy=150}preinit(){p(c.SetCamBaseMultiplier,e=>{this.baseMoveMultiplier=e})}init(e=!1,i=1){this.destroyed=!1;let r=PlayerPedId();SetEntityVisible(r,!1,!1),FreezeEntityPosition(r,!0),SetPlayerControl(PlayerId(),!1,0),this.handle=CreateCamera("DEFAULT_SCRIPTED_CAMERA",!0),SetCamFov(this.handle,this.fov),this.updateCamPosition(),this.updateCamRotation(),RenderScriptCams(!0,e,i,!1,!1)}destroy(e=!1,i=0,r=!1,n=!0){if(this.destroyed)return;this.destroyed=!0,SetPlayerControl(PlayerId(),!0,0);let s=PlayerPedId();IsEntityVisible(s)||SetEntityVisible(s,!0,!1),IsPedInAnyVehicle(s,!1)||SetEntityCollision(s,!0,!1),FreezeEntityPosition(s,!1),SetPlayerInvincible(s,r),ClearPedTasksImmediately(s),n&&ClearFocus(),RenderScriptCams(!1,e,i,!1,!1),DestroyCam(this.handle,!1)}setMoveX(e){this.move.x+=e}setMoveY(e){this.move.y+=e}getPosition(){return this.pos}getCam(){return[this.pos.x,this.pos.y,this.pos.z,this.rot.x,this.rot.y,this.rot.z]}getCamLimitedPrecision(){return Ve(this.getCam(),1e4)}setCam([e,i,r,n,s,o]){this.pos.x=e,this.pos.y=i,this.pos.z=r,this.rot.x=n,this.rot.y=s,this.rot.z=o}setLookAt(e,i,r){this.rot.z=Be([this.pos.x,this.pos.y],[e,i]),this.rot.x=0;let n=this.rot.forward(),s=new y(e-this.pos.x,i-this.pos.y,r-this.pos.z);this.rot.x=me(Math.acos(n.dot(s)/(n.length()*s.length()))),r<this.pos.z&&(this.rot.x*=-1),this.rot.clamp()}getForwardVector(){return this.forwardVector}getSpeedMultiplier(){let e=K(q.MOVE_FAST),i=K(q.MOVE_SLOW),r=this.baseMoveMultiplier,n=1+(se.FAST_MOVE_MULTIPLIER-1)*e,s=1+(se.SLOW_MOVE_MULTIPLIER-1)*i,o=GetFrameTime()*60;return r*n/s*o}updatePosition(){let e=this.move.x,i=this.move.y;!e&&!i?this.acceleration=0:this.acceleration<this.speedy&&(this.acceleration+=GetFrameTime()*1e3,this.acceleration>this.speedy&&(this.acceleration=this.speedy));let r=this.getSpeedMultiplier(),[n,s]=this.rot.directions();this.forwardVector=n.copy();let o=this.acceleration/this.speedy;n.mult(e*r*o),s.mult(i*r*o);let a=n.add(s);if(this.pos.x+=a.x,this.pos.y+=a.y,this.pos.z+=a.z,A.settings.cameraAboveTheGround){let[l,f]=GetGroundZFor_3dCoord(this.pos.x,this.pos.y,this.pos.z-a.z+.5,!1);l&&this.pos.z<f&&(this.pos.z=f+.5)}this.updateCamPosition()}updateRotation(){let e=K(q.LOOK_X)*10,i=K(q.LOOK_Y)*10;this.rot.x+=-i*A.settings.mouseSensetivity/100,this.rot.z+=-e*A.settings.mouseSensetivity/100,this.rot.clamp(),this.updateCamRotation()}update(){this.destroyed||(this.updatePosition(),this.updateRotation())}updateCamPosition(){let e=GetInteriorAtCoords(this.pos.x,this.pos.y,this.pos.z);LoadInterior(e),SetFocusArea(this.pos.x,this.pos.y,this.pos.z,0,0,0),SetCamCoord(this.handle,this.pos.x,this.pos.y,this.pos.z)}updateCamRotation(){SetCamRot(this.handle,this.rot.x,this.rot.y,this.rot.z,2)}},Ue=J("we_movefw","Move Camera forward","keyboard","w"),qe=J("we_movebw","Move Camera backward","keyboard","s"),Ye=J("we_movelb","Move Camera left","keyboard","a"),Xe=J("we_moverb","Move Camera right","keyboard","d");Ue.on(()=>d.setMoveX(1));Ue.off(()=>d.setMoveX(-1));qe.on(()=>d.setMoveX(-1));qe.off(()=>d.setMoveX(1));Ye.on(()=>d.setMoveY(-1));Ye.off(()=>d.setMoveY(1));Xe.on(()=>d.setMoveY(1));Xe.off(()=>d.setMoveY(-1))});function ee(){ge||(I[0]=GetClockHours(),I[1]=GetClockMinutes()),O(c.EnvironmentAck,{hours:I[0],minutes:I[1],prevWeather:Ze(GetPrevWeatherTypeHashName()),nextWeather:Ze(GetPrevWeatherTypeHashName())})}var Ze,I,ge,Ke=u(()=>{L();Y();w();P();Ze=(()=>{let t=new ArrayBuffer(4),e=new Int32Array(t),i=new Uint32Array(t);return r=>(e[0]=r,i[0])})(),I=[0,0,0],ge=!1;p(c.EnvironmentSet,t=>{switch(t.type){case N.TIME:{I[0]=t.hours,I[1]=t.minutes,NetworkOverrideClockTime(t.hours,t.minutes,0),ee();break}case N.FREEZE_TIME:{ge=t.freeze;break}case N.RANDOM_WEATHER:{ClearWeatherTypePersist(),ClearOverrideWeather(),SetRandomWeatherType(),ee();break}case N.PERSISTENT_WEATHER:{SetOverrideWeather(t.weather),SetWeatherTypeNow(t.weather),SetWeatherTypePersist(t.weather),ee();break}}});setTimeout(()=>{O(c.EnvironmentRequest,void 0),SetOverrideWeather("EXTRASUNNY"),SetWeatherTypeNow("EXTRASUNNY"),SetWeatherTypePersist("EXTRASUNNY")},0);setInterval(ee,500);setTick(()=>{ge&&NetworkOverrideClockTime(...I);let t=d.getPosition();SetRandomVehicleDensityMultiplierThisFrame(0),SetParkedVehicleDensityMultiplierThisFrame(0),SetPedDensityMultiplierThisFrame(0),SetVehicleDensityMultiplierThisFrame(0),SetGarbageTrucks(!1),SetRandomBoats(!1),HideHudComponentThisFrame(7),HideHudComponentThisFrame(9),HideHudAndRadarThisFrame(),RemoveVehiclesFromGeneratorsInArea(t.x-500,t.y-500,t.z-500,t.x+500,t.y+500,t.z+500,0)})});function x(t,e,i){t[T.idFromCoords(e,i)]=!0}function St(t){return t|0}var de,T,Je=u(()=>{de=1e3,T=class{static spatialIdFromCoord(e){let i=e<0?e-de:e;return 500+(i/de|0)}static coordFromSectorSpatialId(e){return(e-500)*de}static idFromSpatialIds(e,i){return e*1e3+i}static spatialIdsFromId(e){let i=Math.floor(e/1e3),r=e%1e3;return[i,r]}static idFromCoords(e,i){return T.spatialIdFromCoord(e)*1e3+T.spatialIdFromCoord(i)}static affectedSectorIdsFromCoords(e,i,r=de/2){let n={};return x(n,e-r,i-r),x(n,e,i-r),x(n,e+r,i-r),x(n,e-r,i),x(n,e,i),x(n,e+r,i),x(n,e-r,i+r),x(n,e,i+r),x(n,e+r,i+r),Object.keys(n).map(St)}}});function Qe(t){return t in Se||(Se[t]=typeof t=="string"?V(t):t),Se[t]}function $e(t){return T.idFromCoords(t.mat[m.AX],t.mat[m.AY])}var Se,ce,et,Ee,tt=u(()=>{B();L();Y();Z();Je();w();Se={};ce=Symbol.for("not_loaded"),et=Symbol.for("loading"),Ee=class{constructor(e){this.additions=e;this.activeHandles={};this.activeHandlesToAdditionIdMap={};this.sectors={};this.activeSectors=[];this.activeSectorsMemoizer=new be(this.activeSectors);this.additionSectors={};this.createEventListeners=[];this.maybeUnloadSector=e=>{let i=this.sectors[e];if(!!i&&!this.activeSectors.includes(e))for(let r in i){let n=i[r];typeof n!="symbol"&&this.deleteObject(n),this.updateHandle(r,e,ce)}};Object.entries(e).forEach(([i,r])=>{this.setAdditionSector(i,$e(r))})}destroy(){for(let e of Object.values(this.activeHandles))typeof e=="number"&&DeleteObject(e)}onObjectCreated(e){this.createEventListeners.push(e)}isAddition(e){return e in this.activeHandlesToAdditionIdMap}getObjectId(e){return this.activeHandlesToAdditionIdMap[e]}getObjectHandle(e){let i=this.activeHandles[e];return typeof i=="number"?i:null}set(e,i,r=!1){if(this.additions[e]=i,this.setAdditionSector(e,$e(i)),!r){let n=this.additionSectors[e],s=this.activeHandles[e];this.activeSectors.includes(n)&&typeof s=="number"&&oe(s,i.mat)}}delete(e){let i=this.activeHandles[e];delete this.activeHandlesToAdditionIdMap[i],typeof i=="number"&&this.deleteObject(i),delete this.additions[e],delete this.activeHandles[e];let r=this.additionSectors[e];delete this.additionSectors[e],r&&(delete this.sectors[r][e],Object.keys(this.sectors[r]).length===0&&delete this.sectors[r])}update(){let{x:e,y:i}=d.getPosition(),r=this.activeSectors;this.activeSectors=T.affectedSectorIdsFromCoords(e,i),this.activeSectorsMemoizer.compareAndStore(this.activeSectors)||r.forEach(this.maybeUnloadSector);for(let n of this.activeSectors)this.updateSector(n)}updateSector(e){let i=this.sectors[e];if(!!i)for(let r in i)switch(i[r]){case ce:{let n=Qe(this.additions[r].mdl);RequestModel(n),this.updateHandle(r,e,et);break}case et:{let{mdl:n,mat:s}=this.additions[r],o=Qe(n);if(HasModelLoaded(o)){let a=CreateObject(o,s[12],s[13],s[14],!1,!1,!1);FreezeEntityPosition(a,!0),SetModelAsNoLongerNeeded(o),ae(a,s),this.updateHandle(r,e,a),this.createEventListeners.forEach(l=>l(r,a))}break}}}updateHandle(e,i,r){if(r===ce){let n=this.activeHandles[e];typeof n=="number"&&(delete this.activeHandles[e],delete this.activeHandlesToAdditionIdMap[n])}typeof r=="number"&&(this.activeHandles[e]=r,this.activeHandlesToAdditionIdMap[r]=e),this.sectors[i][e]=r}setAdditionSector(e,i){let r=this.additionSectors[e],n=ce;this.additionSectors[e]=i,r!==void 0&&(n=this.sectors[r][e],delete this.sectors[r][e],Object.keys(this.sectors[r]).length===0&&delete this.sectors[r]),this.sectors[i]||(this.sectors[i]={}),this.updateHandle(e,i,n)}deleteObject(e){DoesEntityExist(e)&&DeleteObject(e)}}});var Ae,it=u(()=>{Ae=class{constructor(){this.listeners=new Set}addListener(e){return this.listeners.add(e),()=>this.listeners.delete(e)}removeListener(e){this.listeners.delete(e)}emit(e){this.listeners.forEach(i=>i(e))}}});var g,le=u(()=>{w();it();P();g=new class{constructor(){this.selectedEntity=null;this.disabled=!1;this.selectionChangedEvent=new Ae;this.rAF=!1}preinit(){p(c.SelectAtCursor,()=>this.select())}init(){SetEntityDrawOutlineColor(255,255,255,255),SetEntityDrawOutlineShader(1)}destroy(){this.resetSelectedEntity(),SetEntityDrawOutlineColor(255,0,255,255),SetEntityDrawOutlineShader(0)}onSelectionChanged(e){this.selectionChangedEvent.addListener(e)}enable(){this.disabled=!1}disable(){this.disabled=!0,this.resetSelectedEntity()}getSelectedEntity(){return this.selectedEntity}setSelectedEntity(e){this.resetSelectedEntity(),this.selectedEntity=e,e!==null&&this.draw()}select(){if(this.disabled)return;let e=SelectEntityAtCursor(6|1<<5,!0);e&&this.selectedEntity!==e&&(this.selectionChangedEvent.emit([e,this.selectedEntity]),this.resetSelectedEntity(),this.selectedEntity!==e&&(this.selectedEntity=e,this.draw()))}resetSelectedEntity(){this.selectedEntity!==null&&(SetEntityDrawOutline(this.selectedEntity,!1),ReleaseScriptGuidFromEntity(this.selectedEntity),this.selectedEntity=null)}draw(){this.rAF||(this.rAF=!0,requestAnimationFrame(()=>{this.rAF=!1,this.selectedEntity!==null&&SetEntityDrawOutline(this.selectedEntity,!0)}))}}});function pe(t,e,i){let r=GetMapdataFromHashKey(t),n=GetEntityIndexFromMapdata(r,e);if(n===-1){console.error("Failed to get entity index from mapdata",{mapdataHash:t,mapdataIndex:r,entityHash:e});return}UpdateMapdataEntity(r,n,{position:[i[12],i[13],i[14]],matrix:Array.from(i)})}function D(t){return typeof t=="string"?parseInt(t,10):t}var te,rt,W,ve,nt=u(()=>{te={},rt=()=>{};on("mapDataLoaded",t=>{te[t]=!0,rt(t)});on("mapDataUnloaded",t=>{delete te[t]});(function(t){t[t.UPDATE=0]="UPDATE",t[t.CREATE=1]="CREATE",t[t.FAIL=2]="FAIL"})(W||(W={}));ve=class{constructor(e){this.patches=e;this.handleMapdataLoaded=e=>{for(let[i,r]of Object.entries(this.patches[e]||{}))pe(e,parseInt(i,10),r.mat)};rt=this.handleMapdataLoaded;for(let i of Object.keys(te))this.handleMapdataLoaded(parseInt(i,10))}isMapdataLoaded(e){return!!te[e]}get(e,i){return this.patches[e]?.[i]}getHandle(e,i){if(!te[e])return null;let[r,n]=GetMapdataEntityHandle(D(e),D(i));return r?n:null}set(e,i,r){this.patches[e]??={},this.patches[e][i]=r,pe(D(e),D(i),r.mat)}updateMat(e,i,r){let n=this.get(e,i);n&&(n.mat=r,pe(D(e),D(i),n.mat))}updateOrCreate(e,i){let r=2,[n,s,o]=GetEntityMapdataOwner(e);if(n){let a=this.get(s,o);a?(r=0,a.mat=i):(r=1,this.patches[s]??={},this.patches[s][o]=a={cam:[0,0,0,0,0,0],label:"",mat:i}),pe(s,o,a.mat)}return[r,s,o]}delete(e,i){this.get(e,i)&&(delete this.patches[e][i],ResetMapdataEntityMatrix(D(e),D(i)))}}});function Et(){return d.getPosition().copy().add(d.getForwardVector().copy().mult(5))}function he(t){return Array.from(t)}function v(t,e,i){DrawLine(t[0],t[1],t[2],e[0],e[1],e[2],i[0],i[1],i[2],i[3])}function H(t,[e,i,r]){return GetOffsetFromEntityInWorldCoords(t,e,i,r)}var k,Me=u(()=>{L();Y();P();Z();tt();le();$();w();nt();k=new class{constructor(){this.enabled=!0;this.map=null;this.lastCamString="";this.objects=null;this.patches=null;this.selection={type:E.NONE};this.selectionHandle=null;this.handleSelectionChanged=([e,i])=>{if(this.selectionHandle=e,!e)return this.selection={type:E.NONE},O(c.Selection,this.selection);let r=this.objects.getObjectId(e);if(r)return this.selection={type:E.ADDITION,id:r},O(c.Selection,this.selection);let[n,s,o]=GetEntityMapdataOwner(e);if(n)return this.selection={type:E.PATCH,mapdata:s,entity:o,label:this.getEntityLabel(e)},this.patches[s]?.[o]||(this.selection.mat=he(z(e)),this.selection.cam=d.getCamLimitedPrecision()),O(c.Selection,this.selection)};this.handleSpawnObject=e=>{let i=Et();e.addition.cam=d.getCamLimitedPrecision(),e.addition.mat=he([1,0,0,0,0,1,0,0,0,0,1,0,i.x,i.y,i.z,1]),Q(c.AdditionPlaced,{id:e.id,cam:e.addition.cam,mat:e.addition.mat}),this.map.additions[e.id]=e.addition,this.objects.set(e.id,e.addition)};this.handleDeleteAddition=e=>{this.handleDeleteAdditions([e])};this.handleDeleteAdditions=e=>{if(this.map)for(let i of e)delete this.map.additions[i],this.objects.delete(i)};this.handleApplyAdditionChange=e=>{if(this.map===null)return;let i=e.id;delete e.id;let r=this.map.additions[i];if(r){let n={...r,...e};this.map.additions[i]=n,this.objects.set(i,n)}}}enable(){this.enabled=!0}disable(){this.enabled=!1}preinit(){EnableEditorRuntime(),g.onSelectionChanged(this.handleSelectionChanged),p(c.Selection,e=>{this.selection=e,this.selectionHandle=null,g.setSelectedEntity(null)}),p(c.AdditionCreate,this.handleSpawnObject),p(c.AdditionSet,({id:e,addition:i})=>{this.map.additions[e]=i,this.objects.set(e,i)}),p(c.AdditionApplyChange,this.handleApplyAdditionChange),p(c.AdditionSetOnGround,e=>{let i=this.map.additions[e];if(!i)return;let r=this.objects.getObjectHandle(e);r!==null&&(PlaceObjectOnGroundProperly(r),this.updateAddition(e,i,z(r)))}),p(c.PatchCreate,({mapDataHash:e,entityHash:i,patch:r})=>{this.patches.set(e,i,r)}),p(c.PatchApplyChange,e=>{e.mat&&this.patches.updateMat(e.mapdata,e.entity,e.mat)}),p(c.PatchDelete,({mapDataHash:e,entityHash:i})=>{this.patches.delete(e,i)}),p(c.AdditionDelete,this.handleDeleteAddition),p(c.AdditionDeleteBatch,this.handleDeleteAdditions),p(c.Map,e=>{this.map=e,setTimeout(()=>{this.applyLoadedMap(),O(c.Ready,void 0)},0)}),p(c.SetCam,e=>d.setCam(e)),p(c.FocusInView,e=>{d.setCam(e.cam),d.setLookAt(...e.lookAt)})}init(){ye(c.Accept,void 0)}update(){if(!!this.map&&(this.objects&&this.objects.update(),this.enabled)){let e=d.getCamLimitedPrecision(),i=JSON.stringify(e);i!==this.lastCamString&&(this.lastCamString=i,ye(c.SetCam,e)),this.updateSelectedEntity()}}updateSelectedEntity(){if(this.selectionHandle!==null&&!DoesEntityExist(this.selectionHandle)&&(this.selectionHandle=null,g.setSelectedEntity(this.selectionHandle)),this.selectionHandle===null&&this.selection.type!==E.NONE){switch(this.selection.type){case E.ADDITION:{this.selectionHandle=this.objects.getObjectHandle(this.selection.id);break}case E.PATCH:{this.selectionHandle=this.patches.getHandle(this.selection.mapdata,this.selection.entity);break}}g.setSelectedEntity(this.selectionHandle)}if(this.selectionHandle===null)return;A.settings.showSelectionBoundingBox&&this.drawBoundingBox(this.selectionHandle);let e=z(this.selectionHandle);if(DrawGizmo(e,this.selectionHandle.toString()))switch(this.selection.type){case E.ADDITION:{let i=this.map.additions[this.selection.id];ae(this.selectionHandle,Array.from(e)),this.updateAddition(this.selection.id,i,e);break}case E.PATCH:{this.updatePatch(this.selectionHandle,e);break}}}destroy(){DisableEditorRuntime(),this.objects&&(this.objects.destroy(),this.objects=null),this.map=null}drawBoundingBox(e){let[i,r]=GetModelDimensions(GetEntityModel(e)),n=H(e,i),s=H(e,[i[0],i[1],r[2]]),o=H(e,[i[0],r[1],r[2]]),a=H(e,[i[0],r[1],i[2]]),l=H(e,[r[0],i[1],i[2]]),f=H(e,[r[0],i[1],r[2]]),_=H(e,r),F=H(e,[r[0],r[1],i[2]]),b=[255,255,255,255];v(n,s,b),v(s,o,b),v(o,a,b),v(a,n,b),v(l,f,b),v(f,_,b),v(_,F,b),v(F,l,b),v(n,l,b),v(s,f,b),v(o,_,b),v(a,F,b)}handleDeletePatch(e,i){this.patches.delete(e,i)}applyLoadedMap(){d.setCam(this.map.meta.cam),this.objects=new Ee(this.map.additions),this.objects.onObjectCreated((e,i)=>{this.selection.type===E.ADDITION&&this.selection.id===e&&(this.selectionHandle=i,g.setSelectedEntity(i))}),this.patches=new ve(this.map.patches)}updatePatch(e,i){let r=he(i),[n,s,o]=this.patches.updateOrCreate(e,r);switch(n){case W.CREATE:{let a={label:this.getEntityLabel(e),cam:d.getCamLimitedPrecision(),mat:r};this.map.patches[s]??={},this.map.patches[s][o]=a,Q(c.PatchCreate,{mapDataHash:s,entityHash:o,patch:a})}case W.UPDATE:{let a=this.map.patches[s][o];a.cam=d.getCamLimitedPrecision(),a.mat=r,Q(c.PatchApplyChange,{mapdata:s,entity:o,mat:a.mat,cam:a.cam})}}}updateAddition(e,i,r){let n={id:e,cam:d.getCamLimitedPrecision(),mat:he(r)};i.cam=n.cam,i.mat=n.mat,this.map.additions[e]=i,this.objects.set(e,i,!0),Q(c.AdditionApplyChange,n)}getEntityLabel(e){return GetEntityArchetypeName(e)||GetEntityModel(e).toString(16).toUpperCase()}}});function st(){let t=d.getForwardVector().copy().mult(5);return d.getPosition().copy().add(t)}function At(t,e){return G([e[0]-t[0],e[1]-t[1],e[2]-t[2]])}var ot,at=u(()=>{P();B();L();Z();w();ot=new class{constructor(){this.currObjectNameHash=0;this.currObjectName="";this.nextObjectName="";this.rotation=0;p(c.ObjectPreview,e=>{this.nextObjectName=e})}update(){if(this.nextObjectName!==this.currObjectName&&(this.objectHandle&&(DeleteObject(this.objectHandle),this.objectHandle=void 0),this.currObjectName=this.nextObjectName,this.currObjectName&&(this.currObjectNameHash=V(this.currObjectName),this.rotation=0,RequestModel(this.currObjectNameHash))),!this.currObjectName)return;if(!this.objectHandle){if(HasModelLoaded(this.currObjectNameHash)){let l=st();this.objectHandle=CreateObject(this.currObjectNameHash,l.x,l.y,l.z,!1,!1,!1),SetModelAsNoLongerNeeded(this.currObjectNameHash)}return}this.updateRotation();let e=st(),[i,r]=GetModelDimensions(this.currObjectNameHash);SetEntityRotation(this.objectHandle,0,0,this.rotation,2,!1);let n=z(this.objectHandle),s=At(i,r),o=3/s,a=i[2]*o/2+r[2]*o/2;_e(n,[o,o,o]),oe(this.objectHandle,n),SetEntityCoords(this.objectHandle,e.x,e.y,e.z-a,!1,!1,!1,!1)}updateRotation(){this.rotation+=GetGameTimer()*5e-7,this.rotation>=360&&(this.rotation=0)}}});var Ce,dt=u(()=>{L();Me();le();$();w();P();Ce=new class{constructor(){this.savedCam=null;this.vehiclePending=!1;this.enable=()=>{k.disable(),g.disable(),this.savedCam=d.getCam();let e=d.getPosition(),i=PlayerPedId(),r=d.getForwardVector(),n=e.x+r.x*5,s=e.y+r.y*5,[o,a]=GetGroundZFor_3dCoord(n,s,e.z,!1);if(o?SetEntityCoords(i,n,s,a,!0,!1,!1,!1):SetEntityCoords(i,n,s,e.z,!0,!1,!1,!1),d.destroy(!0,200,!0,!0),A.settings.playtestSpawnInVehicle&&A.settings.playtestVehicleName){let l=A.settings.playtestVehicleName;IsModelInCdimage(l)&&IsModelAVehicle(l)&&(this.vehicleModel=l,this.vehiclePending=!0,RequestModel(l))}SetEntityHeading(i,this.savedCam[5]),SetGameplayCamRelativeHeading(0)};this.disable=e=>{let i=[...GetGameplayCamCoord(),...GetGameplayCamRot(2)];k.enable(),g.enable(),d.init(!0,200),e?d.setCam(i):this.savedCam&&d.setCam(this.savedCam),this.vehicleHandle!==void 0&&DeleteVehicle(this.vehicleHandle)}}preinit(){p(c.EnterPlaytestMode,this.enable),p(c.ExitPlaytestMode,this.disable)}update(){if(this.vehiclePending&&HasModelLoaded(this.vehicleModel)){this.vehiclePending=!1;let e=GetEntityCoords(PlayerPedId()),i=GetEntityHeading(PlayerPedId());this.vehicleHandle=CreateVehicle(this.vehicleModel,e[0],e[1],e[2],i,!1,!1),SetVehicleNeedsToBeHotwired(this.vehicleHandle,!1),SetVehicleEngineOn(this.vehicleHandle,!0,!0,!1),SetPedIntoVehicle(PlayerPedId(),this.vehicleHandle,-1),SetVehicleRadioEnabled(this.vehicleHandle,!1)}}}});var vt={};var ct=u(()=>{Ke();L();Me();at();$();dt();le();g.preinit();A.preinit();d.preinit();k.preinit();Ce.preinit();setTimeout(()=>{g.init(),d.init(),k.init(),setTick(()=>{d.update(),ot.update(),k.update(),Ce.update()}),ShutdownLoadingScreen(),DoScreenFadeIn(0)},0);on("disconnecting",()=>{g.destroy(),d.destroy(),k.destroy()});on("onResourceStop",t=>{t===GetCurrentResourceName()&&(g.destroy(),d.destroy(),k.destroy())})});U();on("onClientResourceStart",t=>{t==="sdk-game"&&(C("connected"),ie("connected"))});RegisterCommand("sdk:ackConnected",()=>C("connected"),!1);B();console.log("sdk-game:client started!");switch(Re()){case j.NORMAL:{We();break}case j.WORLD_EDITOR:{ct();break}}
